<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>个人通讯录管理系统</title>
        <link rel="stylesheet" href="https://cdn.488848.xyz/npm/mdui@2.0.1/mdui.css" />
        <script src="https://cdn.488848.xyz/npm/mdui@2.0.1/mdui.global.js"></script>
        <style>
            body {
                margin: 0;
            }
            html,
            body {
                height: 100%;
            }
            .content {
                padding: 0 2rem 0 1rem;
                display: grid;
                grid-template-columns: 76vw 1fr;
                gap: 1rem;
            }
            aside {
                display: flex;
                flex-direction: column;
                gap: 4px;
            }
        </style>
    </head>
    <body>
        <div id="app">
            <mdui-top-app-bar style="position: relative">
                <mdui-button-icon
                    ><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24px">
                        <title>nodejs</title>
                        <path
                            d="M12,1.85C11.73,1.85 11.45,1.92 11.22,2.05L3.78,6.35C3.3,6.63 3,7.15 3,7.71V16.29C3,16.85 3.3,17.37 3.78,17.65L5.73,18.77C6.68,19.23 7,19.24 7.44,19.24C8.84,19.24 9.65,18.39 9.65,16.91V8.44C9.65,8.32 9.55,8.22 9.43,8.22H8.5C8.37,8.22 8.27,8.32 8.27,8.44V16.91C8.27,17.57 7.59,18.22 6.5,17.67L4.45,16.5C4.38,16.45 4.34,16.37 4.34,16.29V7.71C4.34,7.62 4.38,7.54 4.45,7.5L11.89,3.21C11.95,3.17 12.05,3.17 12.11,3.21L19.55,7.5C19.62,7.54 19.66,7.62 19.66,7.71V16.29C19.66,16.37 19.62,16.45 19.55,16.5L12.11,20.79C12.05,20.83 11.95,20.83 11.88,20.79L10,19.65C9.92,19.62 9.84,19.61 9.79,19.64C9.26,19.94 9.16,20 8.67,20.15C8.55,20.19 8.36,20.26 8.74,20.47L11.22,21.94C11.46,22.08 11.72,22.15 12,22.15C12.28,22.15 12.54,22.08 12.78,21.94L20.22,17.65C20.7,17.37 21,16.85 21,16.29V7.71C21,7.15 20.7,6.63 20.22,6.35L12.78,2.05C12.55,1.92 12.28,1.85 12,1.85M14,8C11.88,8 10.61,8.89 10.61,10.39C10.61,12 11.87,12.47 13.91,12.67C16.34,12.91 16.53,13.27 16.53,13.75C16.53,14.58 15.86,14.93 14.3,14.93C12.32,14.93 11.9,14.44 11.75,13.46C11.73,13.36 11.64,13.28 11.53,13.28H10.57C10.45,13.28 10.36,13.37 10.36,13.5C10.36,14.74 11.04,16.24 14.3,16.24C16.65,16.24 18,15.31 18,13.69C18,12.08 16.92,11.66 14.63,11.35C12.32,11.05 12.09,10.89 12.09,10.35C12.09,9.9 12.29,9.3 14,9.3C15.5,9.3 16.09,9.63 16.32,10.66C16.34,10.76 16.43,10.83 16.53,10.83H17.5C17.55,10.83 17.61,10.81 17.65,10.76C17.69,10.72 17.72,10.66 17.7,10.6C17.56,8.82 16.38,8 14,8Z"
                        /></svg
                ></mdui-button-icon>
                <mdui-top-app-bar-title> 个人通讯录管理系统</mdui-top-app-bar-title>
                <mdui-button-icon @click="data.value=[]; getData()"
                    ><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24px">
                        <title>refresh</title>
                        <path
                            d="M17.65,6.35C16.2,4.9 14.21,4 12,4A8,8 0 0,0 4,12A8,8 0 0,0 12,20C15.73,20 18.84,17.45 19.73,14H17.65C16.83,16.33 14.61,18 12,18A6,6 0 0,1 6,12A6,6 0 0,1 12,6C13.66,6 15.14,6.69 16.22,7.78L13,11H20V4L17.65,6.35Z"
                        /></svg
                ></mdui-button-icon>
            </mdui-top-app-bar>

            <div class="content">
                <main>
                    <mdui-list v-for="row in data">
                        <mdui-list-item headline-line="1" description-line="2">
                            <mdui-icon slot="icon"
                                ><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                                    <title>account</title>
                                    <path
                                        d="M12,4A4,4 0 0,1 16,8A4,4 0 0,1 12,12A4,4 0 0,1 8,8A4,4 0 0,1 12,4M12,14C16.42,14 20,15.79 20,18V20H4V18C4,15.79 7.58,14 12,14Z"
                                    /></svg
                            ></mdui-icon>
                            <strong> Name: {{row.name}} </strong>
                            <span slot="description">
                                <div>Address: {{row.address}}</div>
                                <div>Phone: {{row.phone}}</div>
                            </span>
                            <mdui-icon slot="end-icon" @click="onDelete(row)"
                                ><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                                    <title>delete-outline</title>
                                    <path
                                        d="M6,19A2,2 0 0,0 8,21H16A2,2 0 0,0 18,19V7H6V19M8,9H16V19H8V9M15.5,4L14.5,3H9.5L8.5,4H5V6H19V4H15.5Z"
                                    /></svg
                            ></mdui-icon>
                        </mdui-list-item>
                    </mdui-list>
                </main>
                <aside>
                    <h1>添加联系人</h1>
                    <mdui-text-field clearable label="Name" v-model="inputs.name"></mdui-text-field>
                    <mdui-text-field clearable label="Address" v-model="inputs.address"></mdui-text-field>
                    <mdui-text-field clearable label="Phone" v-model="inputs.phone"></mdui-text-field>
                    <mdui-button @click="onButtonClick">确认</mdui-button>
                </aside>
            </div>
        </div>
    </body>

    <script type="module">
        import {
            createApp,
            ref,
            reactive,
            onMounted,
        } from "https://cdn.488848.xyz/npm/vue@3.3.6/dist/vue.esm-browser.js";

        function setup() {
            const data = ref([]);
            const inputs = reactive({
                name: "",
                address: "",
                phone: "",
            });

            const getData = async () => {
                const arr = await fetch("/api/get").then((res) => res.json());
                data.value = arr;
                return arr;
            };

            const postData = async (data) => {
                const res = await fetch("/api/post", {
                    headers: {
                        "content-type": "application/json",
                    },
                    method: "POST",
                    body: JSON.stringify(data),
                });
                if (!res.ok) {
                    alert(await res.text());
                    return;
                }
                alert("成功");
                return await getData();
            };

            const deleteData = async (data) => {
                const res = await fetch("/api/delete", {
                    headers: {
                        "content-type": "application/json",
                    },
                    method: "DELETE",
                    body: JSON.stringify(data),
                });
                if (!res.ok) {
                    alert(await res.text());
                    return;
                }
                alert("成功");
                return await getData();
            };

            const onButtonClick = async () => {
                await postData(inputs);
                inputs.name = "";
                inputs.address = "";
                inputs.phone = "";
            };

            const onDelete = async (data) => {
                deleteData(data);
            };

            onMounted(async () => {
                await getData();
            });

            return { data, getData, postData, inputs, onButtonClick, onDelete };
        }

        createApp({
            setup,
        }).mount("#app");
    </script>
</html>
